<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Buddies Page</title>
    <base href="/">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- <script src="../script/script.js"></script> -->
    <script src="https://code.jquery.com/jquery.js"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

</head>

<style>
    body {
        width: 100%;
        height: 100%
    }

    .jumbotron {
        padding: 0.4em 0.5em;
    }

    h1,
    h2,
    h4,
    h6 {
        font-size: 2em;

    }

    .option {
        padding: 5px 30px 5px 12px;
        border: 1px solid rgba(0, 0, 0, 0.2);
        display: inline-block;
        cursor: pointer
    }

    .dropdown-link:hover {
        background-color: #f1faff;
    }

    select>optgroup {
        position: absolute;
        margin-top: -1px;
        -webkit-transition: all 0.2s;
        -moz-transition: all 0.2s;
        -ms-transition: all 0.2s;
        -o-transition: all 0.2s;
        transition: all 0.2s;
        text-align: left !important;
        left: auto !important;
    }

    /* optgroup {
        left: auto !important
    } */

    #body2 :first-child {
        width: 18%v !important;
        height: 18% !important
    }

    #modal {
        max-width: 90% !important;
    }

    img {
        width: 60%;
        height: 60%
    }

    /* <!-- 
    ul.lastChild {
        right: 4px;
        left: auto;
    }

    option {
        direction: ltr;
    } --> */
</style>
</head>

<body>

    <div class="container">
        <div class="jumbotron">
            <h2 class="text-center">Hey, Match up With a Buddy for Whatever Reason!</h2>
            <br>
            <h4 class="text-center">Remember to stick next to your Buddy in case you get lost or entangled!</h4>
            <br>
            <h6 class="text-center">If you get confused, tell your buddy!</h6>
        </div>
        <div class="dropdown row justify-content-between">
            <div class="col-sm-6">How would rate your overall level of disquitetude?</div>
            <select class="dropdown-header col-sm-1" data-toggle="dropdown">
                <optgroup label="1-Lowest, 5-Highest">
                    <option data-selected="1" data-capacity="100000" value="1">
                        1
                    </option>
                    <option data-selected="2" data-capacity="200000" value="2">
                        2
                    </option>
                    <option data-selected="3" data-capacity="300000" value="3">
                        3
                    </option>
                    <option data-selected="4" data-capacity="400000" value="4">
                        4
                    </option>
                    <option data-selected="5" data-capacity="500000" value="5">
                        5
                    </option>
                </optgroup>
            </select>
        </div>

        <div class="dropdown row justify-content-between">
            <div class="col-sm-6">How would rate your perc level of ingratitude?</div>
            <select class="dropdown-header col-sm-1" data-toggle="dropdown">
                <optgroup label="1-Lowest, 5-Highest">
                    <option data-selected="1" data-capacity="100000" value="1">
                        1
                    </option>
                    <option data-selected="2" data-capacity="200000" value="2">
                        2
                    </option>
                    <option data-selected="3" data-capacity="300000" value="3">
                        3
                    </option>
                    <option data-selected="4" data-capacity="400000" value="4">
                        4
                    </option>
                    <option data-selected="5" data-capacity="500000" value="5">
                        5
                    </option>
                </optgroup>
            </select>
        </div>

        <div class="dropdown row justify-content-between">
            <div class="col-sm-6">How would rate your overall level of exactitude?</div>
            <select class="dropdown-header col-sm-1" data-toggle="dropdown">
                <optgroup label="1-Lowest, 5-Highest">
                    <option data-selected="1" data-capacity="100000" value="1">
                        1
                    </option>
                    <option data-selected="2" data-capacity="200000" value="2">
                        2
                    </option>
                    <option data-selected="3" data-capacity="300000" value="3">
                        3
                    </option>
                    <option data-selected="4" data-capacity="400000" value="4">
                        4
                    </option>
                    <option data-selected="5" data-capacity="500000" value="5">
                        5
                    </option>
                </optgroup>
            </select>
        </div>

        <div class="dropdown row justify-content-between">
            <div class="col-sm-6">How would rate your overall level of inaptitude?</div>
            <select class="dropdown-header col-sm-1" data-toggle="dropdown">
                <optgroup label="1-Lowest, 5-Highest">
                    <option data-selected="1" data-capacity="100000" value="1">
                        1
                    </option>
                    <option data-selected="2" data-capacity="200000" value="2">
                        2
                    </option>
                    <option data-selected="3" data-capacity="300000" value="3">
                        3
                    </option>
                    <option data-selected="4" data-capacity="400000" value="4">
                        4
                    </option>
                    <option data-selected="5" data-capacity="500000" value="5">
                        5
                    </option>
                </optgroup>
            </select>
        </div>


        <div class="dropdown row justify-content-between">
            <div class="col-sm-6">How would you rate your overall level of lassitude?</div>
            <select class="dropdown-header col-sm-1" data-toggle="dropdown">
                <optgroup label="1-Lowest, 5-Highest">
                    <option data-selected="1" data-capacity="100000" value="1">
                        1
                    </option>
                    <option data-selected="2" data-capacity="200000" value="2">
                        2
                    </option>
                    <option data-selected="3" data-capacity="300000" value="3">
                        3
                    </option>
                    <option data-selected="4" data-capacity="400000" value="4">
                        4
                    </option>
                    <option data-selected="5" data-capacity="500000" value="5">
                        5
                    </option>
                </optgroup>
            </select>
        </div>

        <div class="dropdown row justify-content-between">
            <div class="col-sm-6">How would rate your overall level of plenitude?</div>
            <select class="dropdown-header col-sm-1" data-toggle="dropdown">
                <optgroup label="1-Lowest, 5-Highest">
                    <option data-selected="1" data-capacity="100000" value="1">
                        1
                    </option>
                    <option data-selected="2" data-capacity="200000" value="2">
                        2
                    </option>
                    <option data-selected="3" data-capacity="300000" value="3">
                        3
                    </option>
                    <option data-selected="4" data-capacity="400000" value="4">
                        4
                    </option>
                    <option data-selected="5" data-capacity="500000" value="5">
                        5
                    </option>
                </optgroup>
            </select>
        </div>

        <div class="dropdown row justify-content-between">
            <div class="col-sm-6">How would rate your overall level of dissimilitude?</div>
            <select class="dropdown-header col-sm-1" data-toggle="dropdown">
                <optgroup label="1-Lowest, 5-Highest">
                    <option data-selected="1" data-capacity="100000" value="1">
                        1
                    </option>
                    <option data-selected="2" data-capacity="200000" value="2">
                        2
                    </option>
                    <option data-selected="3" data-capacity="300000" value="3">
                        3
                    </option>
                    <option data-selected="4" data-capacity="400000" value="4">
                        4
                    </option>
                    <option data-selected="5" data-capacity="500000" value="5">
                        5
                    </option>
                </optgroup>
            </select>
        </div>

        <div class="dropdown row justify-content-between">
            <div class="col-sm-6">How would rate your overall level of incertitude?</div>
            <select class="dropdown-header col-sm-1" data-toggle="dropdown">
                <optgroup label="1-Lowest, 5-Highest">
                    <option data-selected="1" data-capacity="100000" value="1">
                        1
                    </option>
                    <option data-selected="2" data-capacity="200000" value="2">
                        2
                    </option>
                    <option data-selected="3" data-capacity="300000" value="3">
                        3
                    </option>
                    <option data-selected="4" data-capacity="400000" value="4">
                        4
                    </option>
                    <option data-selected="5" data-capacity="500000" value="5">
                        5
                    </option>
                </optgroup>
            </select>
        </div>

        <div class="dropdown row justify-content-between">
            <div class="col-sm-6">How would rate your overall level of turpitude?</div>
            <select class="dropdown-header col-sm-1" data-toggle="dropdown">
                <optgroup label="1-Lowest, 5-Highest">
                    <option data-selected="1" data-capacity="100000" value="1">
                        1
                    </option>
                    <option data-selected="2" data-capacity="200000" value="2">
                        2
                    </option>
                    <option data-selected="3" data-capacity="300000" value="3">
                        3
                    </option>
                    <option data-selected="4" data-capacity="400000" value="4">
                        4
                    </option>
                    <option data-selected="5" data-capacity="500000" value="5">
                        5
                    </option>
                </optgroup>
            </select>
        </div>

        <div class="dropdown row justify-content-between">
            <div class="col-sm-6">How would rate your overall level of pulchritude?</div>
            <select class="dropdown-header col-sm-1" data-toggle="dropdown">
                <optgroup label="1-Lowest, 5-Highest">
                    <option data-selected="1" data-capacity="100000" value="1">
                        1
                    </option>
                    <option data-selected="2" data-capacity="200000" value="2">
                        2
                    </option>
                    <option data-selected="3" data-capacity="300000" value="3">
                        3
                    </option>
                    <option data-selected="4" data-capacity="400000" value="4">
                        4
                    </option>
                    <option data-selected="5" data-capacity="500000" value="5">
                        5
                    </option>
                </optgroup>
            </select>
        </div>
        <footer class="footer">
            <div class="text-center">
                <button class="btn btn-lg btn-primary float-right" data-toggle="modal" data-target="#exampleModal0" id="submit">
                    <span class="fa fa-list-alt"></span> SUBMIT </button>

                <div class="modal fade" id="myModal">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">

                            <!-- Modal Header -->
                            <div class="modal-header">
                                <h4 class="modal-title text-center">Your Matched Buddies!!!</h4>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>

                            <!-- Modal body -->
                            <div class="modal-body" id="body1">
                                Modal body..
                            </div>
                            <hr>
                            <div class="modal-body" id="body2">
                                Modal body..
                            </div>


                            <!-- Modal footer -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" id="save">Save to Local Storage!</button>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="clear">Clear Survey</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container">
                <p>
                    <a href="/api/friends">API Buddy Link</a> |
                    <a href="https://github.com/GeneralAnesthetic/HomeWork11/tree/master/friendsApp">GitHub Repo</a>
                </p>
            </div>
        </footer>

    </div>


</body>


<script type="text/javascript">

    $(document).ready(function () {

        // $("#json").on("click", function (e) {
        //     e.preventDefault();
        //     console.log(e);
        //     $('modal :not(:last)').remove().html(data);
        // $('#myModal').show(); $('.modal-header').hide(); $('#body2').hide(); $('#save').hide(); $('#myModal').html(data); $('#clear').show();

    });
    // $("button :not(.btn btn-lg btn-primary)")
    // var submitButton = $("button).first().next();
    $("#submit").on("click", function (e) {
        e.preventDefault();
        $('#myModal').modal('toggle');
        // $('#myModal').modal('show');
        //             $("[data-toggle='modal']").modal();
        // $("#exampleModalLong").attr("aria-hidden='false'");


        // console.log(e);
        // var newArray = [];
        var newArr = [];
        $(".dropdown option:selected").html(function (i, html) {
            newArr.push(html);
        });
        // var reqInfo = req.body;
        var arr = newArr.map(function (x) {
            return parseInt(x, 10);
        });
        // var result = reqInfo.map(function(x) {
        //   return parseInt(x, 10);
        // });
        // var arr = $(".dropdown option:selected").map(function () {
        //     return this.innerHTML;
        // }).get();
        // newArray.push(arr);
        console.log("HTML Elements Pushed to a New Array without White-Spaces: ", arr);

        // $.ajax({
        //     url: currentURL + "/api/friends",
        //     type: 'POST',
        //     contentType: 'application/json',
        //     data: JSON.stringify(arr),
        //     error: function (err) {
        //         if (err) { console.log("Server Rejected Data") }
        //     }
        // });


        // // var friendsData = [];
        // $.ajax({ url: currentURL + "/api/friends", method: "GET" })
        //     .then(function (data) {

        // friendsData.push(data);
        // console.log("This is comming back from the server as an entire webpage...Friends ObjectData: ", data);
        // console.log("Friends ObjectData: ", friendsData);


        var currentURL = window.location.origin;
        console.log("Current URL Loaction: ", currentURL);
        $.ajax({ url: currentURL + "/api/friends", method: "GET" })
            .then(function (data) {


                var matchName = '';
                var matchPic = '';
                var totalDiff = 10;


                for (var i = 0; i < data.length; i++) {
                    console.log('friend = ' + JSON.stringify(data[i]));
                    var filtered = data[i].scores.filter(
                        function (e) {
                            return this.indexOf(e) < 0;
                        },
                        [2, 4]
                    );
                    console.log("filtered", filtered);

                    var diffy = 0;
                    for (var j = 0; j < arr.length; j++) {

                        diffy += Math.abs(data[i].scores[j] - arr[j]);

                        console.log("var diffy: ", diffy);
                        if (diffy < totalDiff) {



                            matchName = data[j].name,
                                matchPic = $("<img src =" + "'" + data[j].photo + "'" + "styles = width:60%; height:60%'</img>");
                            $("#body1").html(matchName);
                            $("#body2").html(matchPic);
                            console.log("object being sent: ", { matchName: matchName, matchPic: matchPic });


                            // friendsData.push(arr);
                            // res.send({ status: 200, matchName: matchName, matchPic: matchPic });;


                            $("#save").on("click", function () {
                                if (typeof (storage) !== null || typeof (storage) !== undefined) {
                                    localStorage.setItem(matchName);
                                    localStorage.setItem(matchPic);
                                }
                                else if (typeof (storage) !== null || typeof (storage) !== undefined) {
                                    $("#body1").html(localStorage.getItem(matchName));
                                    $("#body2").html(localStorage.getItem(matchPic));
                                }
                                else {
                                    alert("Your Match-Data Did Not Save! Please Complete the Survey Again Buddy!");
                                    $(".modal").hide();
                                    location.reload();
                                }
                            })


                        }
                    }
                }
            })

        $("#clear").on("click", function () {
            alert("Clearing Survey for Restart...");
            $("#body1").val("");
            $("#body2").val("");
            var currentURL = window.location.origin;
            $.ajax({ url: currentURL + "/clear", method: "POST" });
            location.reload();
        }
            // Refresh the page after data is cleared



            // var selectedItem = $(".dropdown option:selected").each(function (i, v) {
            //     // while (i < 11) { arr.push(i); }
            //     // arr.push[i];
            //     console.log(arr.push(i[v]));

            // })
            // console.log("selectedDropDownItems", arr);

            //     while (value < 11) {
            //         console.log(value)

            //     }
            // arr.join(selectedItem.length);
            // for (i = 1; i < selectedItem.length; i++) {
            //     arr.push(selectedItem.length[i]);
            // }
            // console.log("master array", arr)

            // forEach(myFunction);
            // function myFunction(value) {
            //     console.log(value);
            //     var boozeHound = $(this).attr('value');
            //     arr.push(boozeHound);
            //     // <!-- there's the Map function ... numbers.map(Math.abs); -->
            // console.log("masterArray", arr); // var newArray = $(this).val().concat(arr); // console.log("newArray", newArray) //
            // arr.push(newArray); // console.log("masterArray", arr); // arr.push(value).slice(10); // console.log(arr); $(this).val()
            // } // }) }) }) //
            // < !--from StackOverflow-- >

            // $('select[id*="lwayer_x002d_EisDikigoros_1eef9a23-7a35-4dcf-8de9-a088b4681b2b"] option').each(function(index,value) {

            // console.log("index is:"+index); // index // console.log("value is"+$(this).val()); // dropdown option value // console.log("dropdown
        )
    })
</script>

</html>